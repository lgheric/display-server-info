jQuery(document).ready(function ($) {

    $('#disi_enable_admin_bar, #disi_enable_widget, #disi_enable_footer').on('change', function () {

        if (typeof disiAjaxObject !== 'undefined') {

            $('#disi-ajax-loader').show();

            var formData = $(this).closest('form').serialize();
            formData += '&nonce=' + disiAjaxObject.nonce;

            //console.log('Form Data:', formData);
            $.ajax({
                url: disiAjaxObject.ajax_url,
                type: 'POST',
                data: formData,
                contentType: 'application/x-www-form-urlencoded',
                success: function (response) {
                    $('#disi-ajax-loader').hide();
                    if (response.success) {
                        showToast(disiAjaxObject.disiLocalizeText.settingsSavedText,'default');
                    } else {
                        showToast(disiAjaxObject.disiLocalizeText.errorOccurredText + 'ï¼š' + response.data.message,'error');
                    }
                },
                error: function (xhr) {
                    $('#disi-ajax-loader').hide();

                    if (xhr.status === 400) {
                        showToast(disiAjaxObject.disiLocalizeText.invalidRequestText,'error');
                    }else if (xhr.status === 401) {
                        showToast(disiAjaxObject.disiLocalizeText.loginTimeoutText,'error');
                        window.location.reload();
                    } else if(xhr.status === 418){
                        showToast(disiAjaxObject.disiLocalizeText.illegalRequestText,'error');
                    } else if(xhr.status === 403){
                        showToast(disiAjaxObject.disiLocalizeText.loginTimeoutText,'error');
                    } else {
                        showToast(xhr.status+' '+xhr.statusText,'error')
                    }
                },
            });

        }else{
            console.error('disiAjaxObject is not defined');
        }

    });

    $('#btn-phpinfo-output').on("click",function(){
        if (typeof disiAjaxObject !== 'undefined') {

            $('#disi-ajax-loader').show();
            $('.disi-phpinfo-div').show();

            $.ajax({
                url: disiAjaxObject.ajax_url,
                method: 'POST',
                data: {
                    action: 'disi_get_phpinfo',
                },
                success: function (response) {
                    $('#disi-ajax-loader').hide();
                    if (response.success) {
                        //$('.disi-phpinfo-body').html(response.data.phpinfo).show();

                        var newWindow = window.open('', 'phpinfo()', 'width=800,height=600');
                        newWindow.document.write('<html><head><title>phpinfo()</title></head><body>');
                        newWindow.document.write(response.data.phpinfo);
                        newWindow.document.write('</body></html>');
                    }
                },
                error: function (xhr) {
                    $('#disi-ajax-loader').hide();
                    $('.disi-phpinfo-div').hide();
                }

            })

        }
    })

    function showToast(message, type = 'default', duration = 2000) {
        const toast = document.createElement('div');
        toast.className = `disi-toast disi-toast-${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.classList.add('fade-out');
            toast.addEventListener('transitionend', () => toast.remove());
        }, duration);
    }

});

